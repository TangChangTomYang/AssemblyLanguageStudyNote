##åŠ¨æ€è°ƒè¯•

####ä¸€ã€ä»€ä¹ˆæ˜¯åŠ¨æ€è°ƒè¯•ï¼Ÿ
![](/assets/Snip20180605_5.png)
**å½“æˆ‘ä»¬åœ¨Xcode ä¸­æ‰“ä¸€ä¸ªæ–­ç‚¹æ—¶ï¼ŒXcodeå…ˆå°†è¿™ä¸ªæ–­ç‚¹çš„ä¿¡æ¯å‘é€ç»™æ‰‹æœºä¸Šå®‰è£…çš„debugserver æœåŠ¡å™¨ï¼Œè¿™ä¸ªdebugserver æœåŠ¡å™¨å°†ä¿¡æ¯è½¬å‘ä¸ªAppï¼ŒApp åœ¨å°†ä¿¡æ¯åé¦ˆç»™debugserverï¼Œdebugserver å†å°†ä¿¡æ¯å‘é€ç»™Xcode ï¼Œè®©åæˆ‘ä»¬åœ¨Xcode ä¸Šé¢å°±èƒ½çœ‹è§è°ƒè¯•ä¿¡æ¯äº†ï¼Œè¿™å°±æ˜¯å°±æ˜¯åŠ¨æ€è°ƒè¯•çš„åŸç†ã€‚**


####äºŒã€Xcode åŠ¨æ€è°ƒè¯•çš„åŸç†
- 1ã€ **å…³äºGCCã€LLVMã€GDBã€LLDB**<br> Xcode çš„**ç¼–è¯‘å™¨**å‘å±•å†ç¨‹ï¼šGCC -> LLVM <br> Xcode çš„**è°ƒè¯•å™¨**å‘å±•å†ç¨‹ï¼šGDB -> LLDB

- 2ã€**debugserverï¼ˆiphoneç«¯æ–­ç‚¹è°ƒè¯•æœåŠ¡ç¨‹åºï¼‰æœ€åˆæ˜¯å­˜æ”¾åœ¨mac çš„Xcode é‡Œé¢**
```
/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport/9.1/DeveloperDiskImage.dmg/usr/bion/debugserver
```


- 3ã€**å½“Xcode è¯†åˆ«åˆ°æ‰‹æœºçš„è®¾å¤‡æ—¶(é€šè¿‡Xcodeç»™æ‰‹æœºå®‰è£…app)ï¼ŒXcode ä¼šè‡ªåŠ¨å°†debugserverå®‰è£…åˆ°iPhone ä¸Šã€‚è·¯åŠ²å¦‚ä¸‹ï¼š**

  ```
  /Developer/usr/bin
  ```

- 4ã€**Xcode è°ƒè¯•çš„å±€é™æ€§,ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªèƒ½è°ƒè¯•é€šè¿‡Xcodeå®‰è£…çš„App**<br><br>![](/assets/Snip20180605_4.png)

####ä¸‰ã€åŠ¨æ€è°ƒè¯•ä»»æ„App
- 1ã€**iPhoneä¸Šçš„debugserver åœ¨å“ªé‡Œå‘¢ï¼Ÿ**
```
/Developer/usr/bin
```
**æ³¨æ„ï¼šè¿™ä¸ªè·¯åŠ²çš„æ–‡ä»¶å¯èƒ½ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨åˆ æ‰ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ç”¨çœŸæœºè°ƒè¯•ä¸€ä¸‹(ä½¿ç”¨Xcodeå®‰è£…app ï¼Œæ‰“æ–­ç‚¹)å³å¯**<br>
<br>

- 2ã€**debugserver æƒé™çš„é—®é¢˜**<br><br>(1)ã€é»˜è®¤æƒ…å†µä¸‹ï¼Œ/Developer/usr/bin ç›®å½•ä¸‹çš„debugserver æƒé™æ˜¯ä¸å¤Ÿçš„ï¼ˆå› ä¸ºè¿™ä¸ªdebugserver æ˜¯Xcode å¸®ç€å®‰è£…çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹åªèƒ½è°ƒè¯•Xcodeå®‰è£…çš„Appï¼Œåªæœ‰è¿™ä¸ªæƒé™ï¼Œåƒæ¥è‡ªApp store çš„App éƒ½æ˜¯è°ƒè¯•ä¸äº†çš„ï¼‰ã€‚<br>(2)ã€/Developer è¿™ä¸ªæ–‡ä»¶å¤¹çš„æƒé™æ˜¯åªè¯»çš„ï¼Œ(å…¶ä»–åœ°æ–¹æ–‡ä»¶æ˜¯æ”¾ä¸è¿›å»çš„)ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚<br>(3)ã€å¦‚æœéœ€è¦è°ƒè¯•å…¶ä»–çš„appï¼Œéœ€è¦å¯¹debugServeré‡æ–°ç­¾æƒé™ï¼Œç­¾ä¸Š2ä¸ªè°ƒè¯•ç›¸å…³çš„æƒé™ï¼Œå¦‚ä¸‹å³å¯ï¼š
```
get-task-allow
task_for_pid-allow
```
<br>
- 3ã€**å¦‚ä½•ç»™debugserverç­¾ä¸Šæƒé™ï¼Ÿ**<br><br>(1)ã€iphoneä¸Šçš„ **/Developer**ç›®å½•æ˜¯åªè¯»çš„ï¼Œæ— æ³•ç›´æ¥å¯¹**/Developer/usr/bin/debugserver**æ–‡ä»¶ç­¾åï¼Œéœ€è¦å…ˆæŠŠdebugserverå¤åˆ¶åˆ°macä¸Šï¼Œå†é€šè¿‡ldidç­¾åï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨Codesignç­¾åï¼‰ã€‚

    ```
    //1.å…ˆå°†æƒé™å¯¼å‡º
    $ ldid -e debugserver > debugserver.entitlements

    //2.debugserver.entitlementsæ–‡ä»¶ä¸­åœ¨æ·»åŠ 2æ¡æƒé™
    get-task-allow = YES
    task_for_pid-allow  = YES

    //3.å†å°†æƒé™ç­¾å›å»å³å¯
    ldid -Sdebugserver.entitlements  debugserver

    //4. å°†æ–‡ä»¶è£…å›iphone å³å¯(è¿™æ˜¯ ä¸å¯èƒ½çš„äº‹ /Developer æ–‡ä»¶å¤¹æ˜¯åªè¯»çš„)
    //5.å°†ä¿®æ”¹è¿‡æƒé™çš„debugserver æ”¾åœ¨ /usr/bin è·¯åŠ²ä¸‹ï¼Œæˆ‘ä»¬ä»¥åä¼šé€šè¿‡ç»ˆç«¯æ¥ä½¿ç”¨å®ƒã€‚
    ```
    ![](/assets/Snip20180610_18.png)(2)ã€ä½¿ç”¨codesignç­¾å
   
 
   ```
  //æŸ¥çœ‹æƒé™ä¿¡æ¯
  $ codesign -d --entitlements - debugserver

  //ç­¾åæƒé™
  $ codesign -f -s - --entitlements debugserver

  //æˆ–è€…ç®€å†™
  $ codesign -fs- --entitlements debugserver
  ```    
    
- 4ã€ **æ³¨æ„ï¼š**<br>ç›´æ¥å°†ç­¾åå›å»çš„debugserver ç›´æ¥æ‹–å›å»æ˜¯ä¸è¡Œçš„ã€‚æ˜¯ä¸èƒ½è¦†ç›– **/Developer/usr/bin** ç›®å½•çš„ã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ<br> æ˜¯è¿™æ ·çš„ï¼Œåˆ°æ—¶æˆ‘ä»¬éœ€è¦åœ¨æ‰‹æœºç«¯å¯åŠ¨Debugserver è¿™ä¸ªæœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å°† debugserver æ‹–åˆ° /usr/binç›®å½•ä¸‹äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ‰‹æœºä¸Šé€šè¿‡ç»ˆç«¯æ¥å¯åŠ¨debugserveräº†ã€‚<br>
<br>**debugserver å¸¸ç”¨æ³•ï¼š**
```
Usage:
  debugserver host:port [program-name program-arg1 program-arg2 ...]
  debugserver /path/file [program-name program-arg1 program-arg2 ...]
  debugserver host:port --attach=<pid>
  debugserver /path/file --attach=<pid>
  debugserver host:port --attach=<process_name>
  debugserver /path/file --attach=<process_name>
  ```
**(iPhoneç«¯)æœ€å¸¸ç”¨çš„ä¸€ä¸ªæŒ‡ä»¤:**

  ```
  // è¡¨ç¤ºä»»ä½•å®¢æˆ·ç«¯ï¼ˆmac ç»ˆç«¯ï¼‰ip éƒ½å¯ç›‘å¬10011ç«¯å£ï¼Œ éƒ½å¯ä»¥è¿æ¥è¿‡æ¥
  debugserver *:10011 -a WeChat       
  // -a æ˜¯attachment é™„åŠ çš„æ„æ€ ï¼Œ è¡¨ç¤ºæˆ‘ä»¬è¦è°ƒè¯•WeChatï¼ˆè¿›ç¨‹IDå’Œåå­—éƒ½å¯ä»¥ï¼‰
  // ç«¯å£å·ï¼Œä½¿ç”¨iPhoneçš„æŸä¸ªç«¯å£å¯åŠ¨debugserverï¼ˆåªè¦ä¸æ˜¯ä¿ç•™çš„å³å¯ï¼‰  
                
  ```
  

####å››ã€åŠ¨æ€è°ƒè¯•ä»»æ„App çš„ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š
**iPhone ç«¯ï¼š**
- 1ã€è·å–è¦è°ƒè¯•çš„App çš„è¿›ç¨‹å·æˆ–è€…ID
```
ps -A  // æŸ¥çœ‹æ‰€æœ‰çš„è¿›ç¨‹ä¿¡æ¯,æ¯”å¦‚ï¼šæˆ‘ä»¬è·å–çš„æ˜¯WeChat
```
- 2ã€è®©debugserver é™„åŠ åˆ°æŸä¸ªApp ï¼ˆè¦åŠ¨æ€è°ƒè¯•å“ªä¸ªAppï¼‰
```
debugserver *:10011 -a Wechat
// æˆ‘ä»¬è¿™é‡Œä½¿ç”¨10011ç«¯å£(å…¶ä»–éä¿ç•™éƒ½å¯ä»¥)æ¥ç›‘æ§ Wechatè¿™ä¸ª ç¨‹åº
```
**macç«¯ï¼š**
- 1ã€å¯åŠ¨LLDB
```
$ lldb
(lldb)
```
- 2ã€è¿æ¥debugserveræœåŠ¡
```
//æ–¹å¼1ï¼š
(lldb)
process connect connect://æ‰‹æœºipåœ°å€ï¼šdebugç«¯å£å·

æ–¹å¼2ï¼š
python tcppython -t 10011ï¼š10012
// ä½¿ç”¨macç«¯çš„10012ç«¯å£ç»‘å®šiPhoneç«¯çš„10011ç«¯å£
process connect connect:localhost:10012
```
- 3ã€ä½¿ç”¨LLDBå‘½ä»¤è®©ç¨‹åºç»§ç»­è¿è¡Œ
```
(lldb)continue
```









####å››ã€å¸¸ç”¨çš„LLDB

- 1ã€**LLDB æŒ‡ä»¤æ ¼å¼**
```
<command> [<subcommand> [<subcommand> ...]] <action>  [-options  [option-value]] [argment [argment ...]]
```
**è¯´æ˜ï¼š**<br>(1)ã€å‡¡æ˜¯åœ¨æŒ‡ä»¤è¯´æ˜ä¹¦é‡Œé¢ çœ‹åˆ°çš„ `[]` è¡¨ç¤ºè¿™éƒ¨åˆ†æ˜¯å¯ä»¥çœç•¥çš„ã€‚ <br>(2)ã€ä¸€èˆ¬çš„æŒ‡ä»¤æ ¼å¼éƒ½æ˜¯ï¼š **å‘½ä»¤ã€å­å‘½ä»¤ã€åŠ¨ä½œ**(æ¯”å¦‚ï¼š å‘è®¾ç½®ä¸œè¥¿å‘¢ã€åˆ é™¤ä¸œè¥¿å‘¢ã€è¿˜æ˜¯æ·»åŠ ä¸œè¥¿ ç­‰)ã€**é€‰é¡¹**(æ¯”å¦‚ï¼š -nã€-dã€-i)ã€**å‚æ•°**ã€‚ 
<br>
<br>

- 2ã€**ç»™ testæ–¹æ³•è®¾ç½®æ–­ç‚¹ï¼š**
```
breakpoint set -n test
æˆ–è€…
breakpoint set --name test
// test æ˜¯è¦æ‰“æ–­ç‚¹çš„æ–¹æ³•å
```
**breakpoint æ˜¯ï¼š**`<command>`     <br> **setæ˜¯ï¼š**`<action>`        <br> **-næ˜¯ï¼š**`<options>`    <br>**testæ˜¯ï¼š**`<arguments>` 
 <br> <br> 

- 3ã€**hlep æŒ‡ä»¤çš„ç”¨æ³•ï¼š** **help** `<command>`  <br>å³: ç›´æ¥åœ¨å‘½ä»¤çš„å‰é¢åŠ  help æ¥æŸ¥çœ‹å‘½ä»¤å¸®åŠ©è¯´æ˜ï¼Œ<br>å¦‚ï¼š

  ``` 
  help breakpoint  // æŸ¥çœ‹breakpoint å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯

  help breakpoint set // æŸ¥çœ‹breakpoint set  å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯
  ä¾æ¬¡ç±»æ¨ï¼Œä¸€å±‚ä¸€å±‚çš„æŸ¥çœ‹å¸®åŠ©

  ```
  <br>
<br>


  
- 4ã€**express å‘½ä»¤çš„ä½¿ç”¨ï¼š ** **express** `<cmd -options> - <expr>` <br>è¿™ä¸ªå‘½ä»¤å°± ğŸ‚ B äº†ï¼Œå¯ä»¥åœ¨è°ƒè¯•æ—¶åŠ¨æ€æ’å…¥æ‰§è¡Œä¸€ä¸ªè¡¨è¾¾å¼ ï¼ˆè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè®¾ç½®ä¸€ä¸ªå‚æ•° ç­‰ç­‰ï¼‰ <br><br> `<cmp-options>`å‘½ä»¤çš„é€‰é¡¹ <br> `-- ` å‘½ä»¤é€‰é¡¹ç»“æŸç¬¦ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„å‘½ä»¤é€‰é¡¹å·²ç»è®¾ç½®å®Œæ¯•ï¼Œå¦‚æœæ²¡æœ‰å‘½ä»¤é€‰é¡¹ï¼Œ `--` å¯ä»¥çœç•¥ <br> `<expr>` å°±æ˜¯éœ€è¦æ‰§è¡Œçš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼š
```
// ä¸€æ—¦åœ¨LLDB ä¸­æ‰§è¡Œäº†è¿™å¥ä»£ç ï¼Œå°±ä¼šåœ¨çŸ­ç‚¹çš„ä¸‹ä¸€æ‰§è¡Œå‘½ä»¤å‰å…ˆæ‰§è¡Œ è¿™ä¸ªè¡¨è¾¾å¼
express self.view.backgroundColor = [UIColor redColor];
```
**express -o -- ** å’Œ æŒ‡ä»¤**po**çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚

- 5ã€**thread backtrace** <br> æ‰“å°çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ã€‚<br> å¯ä»¥ç”¨ç®€å†™ï¼š**bt** ä»£æ›¿ï¼Œæ•ˆæœä¸€æ ·çš„ï¼Œéƒ½æ˜¯æ‰“å°å †æ ˆä¿¡æ¯ã€‚

- 6ã€**thread return [<expr>]**<br> è®©å‡½æ•°ç›´æ¥è¿”å›æŸä¸ªå€¼ï¼Œæ–­ç‚¹åé¢çš„ä»£ç ä¸ä¼šæ‰§è¡Œæ‰§è¡Œï¼Œç›´æ¥è·³è¿‡
```
thread return 10;
```

- 7ã€**thread variable [<variable-name>]**<br>æ‰“å°å½“å‰æ ˆå¸§çš„å˜é‡
```
thread variable // å°†ä¼šæ‰“å°å‡ºå½“å‰çš„æ‰€æœ‰çš„å±€éƒ¨å˜é‡çš„å€¼
åˆæˆ–è€…
thread variable a // æ‰“å°å‡ºå˜é‡a çš„å€¼
```

- 8ã€**thread continue** <br> è®©å½“å‰æ–­ç‚¹æ–­ä½çš„ç¨‹åºç»§ç»­æ‰§è¡Œ<br> ç®€å†™ **continue** æˆ–è€… **c**

- 9ã€**thread step-over**<br>å•æ­¥è¿è¡Œï¼ˆä¸€æ¬¡è¿è¡Œä¸€è¡Œä»£ç ï¼ŒæŠŠå­å‡½æ•°å½“æˆæ•´ä½“ä¸€æ­¥æ‰§è¡Œï¼‰<br> ç®€å†™ **next**æˆ–è€…**n**


- 10ã€**thread step-in**<br>å•æ­¥è¿è¡Œï¼ˆä¸€æ¬¡è¿è¡Œä¸€è¡Œä»£ç ï¼Œé‡åˆ°å­å‡½æ•°ä¼šè¿›å…¥å­å‡½æ•°ï¼‰<br>ç®€å†™ **step** æˆ–è€…**s**


- 11ã€**thread step-out**<br> æ‰§è¡Œå®Œå½“å‰å‡½æ•°çš„æ‰€æœ‰ä»£ç ï¼Œè¿”å›åˆ°è°ƒç”¨è¯¥ä»£ç å¤„<br>ç®€å†™**finish**

- 12ã€**thread step-inst-over** æŒ‡ä»¤çº§åˆ«å•æ­¥æ‰§è¡Œï¼ˆæ±‡ç¼–å‡½æ•°è°ƒç”¨å½“æˆä¸€æ­¥æ‰§è¡Œï¼‰<br>ç®€ç§° **nexti** æˆ–è€…**ni**

- 13ã€**thread step-inst** æŒ‡ä»¤çº§åˆ«å•æ­¥è¿è¡Œï¼ˆé‡åˆ°æ±‡ç¼–å‡½æ•°è°ƒç”¨ä¼šè·³è¿›æ±‡ç¼–å‡½æ•°ï¼‰<br>ç®€ç§°**stepi** æˆ–è€…**si**

- 14ã€ **ni**ã€**si** å’Œ **n**ã€**s** ç±»ä¼¼<br> **ni**ã€**si** æ˜¯æ±‡ç¼–æŒ‡ä»¤çº§åˆ«çš„<br> **n**ã€**s** æ˜¯æºç çº§åˆ«çš„ã€‚


- 15ã€**breakpoint set -a å‡½æ•°åœ°å€**
- 16ã€**breakpoint set -n å‡½æ•°å**

```
breakpoint set -n test  //ç»™æ‰€æœ‰çš„test è®¾ç½®æ–­ç‚¹ï¼Œæœ‰å¾ˆå¤šä¸ªï¼ˆè¿™ä¸ªæ˜¯Cè¯­è¨€çš„æ–¹æ³•ï¼‰

breakpoint set -n touchesBeganï¼šwithEventï¼š  // ç»™å¾ˆå¤šä¸ªtouchesBeganï¼šwithEventï¼š è®¾ç½®æ–­ç‚¹ï¼ˆè¿™ä¸ªæ˜¯oc çš„æ–¹æ³•ï¼‰

breakpoint set -n â€œViewController touchesBeganï¼šwithEventï¼šâ€ ç»™å½“å‰æ§åˆ¶å™¨çš„ touchesBeganï¼šwithEventï¼š è®¾ç½®æ–­ç‚¹
```

- 16.1ã€ **breakpoint set -r æ­£åˆ™è¡¨è¾¾å¼**ï¼Œç»™åŒ¹é…æ­£åˆ™çš„æ‰€æœ‰æ–¹æ³•åŠ æ–­ç‚¹
```
breakpoint set -r "abc" //ç»™æ‰€æœ‰åŒ…å«abc çš„æ–¹æ³•è®¾ç½®æ–­ç‚¹
```

- 16.2ã€**breakpoint set -s åŠ¨æ€åº“ -n å‡½æ•°å**
```
breakpoint set -s lib.dylib -n abc  //-sæ˜¯shlib çš„æ„æ€ï¼Œ lib.dylib æ˜¯åŠ¨æ€åº“çš„åç§°
```

- 17ã€**breakpoint list**<br> åˆ—å‡ºæ‰€æœ‰çš„æ–­ç‚¹ï¼ˆæ¯ä¸ªæ–­ç‚¹éƒ½æœ‰è‡ªå·±çš„ç¼–å·ï¼‰

- 18ã€**breakpoint disable æ–­ç‚¹å·**ï¼Œç¦ç”¨æŸä¸ªæ–­ç‚¹

- 19ã€**breakpoint enable æ–­ç‚¹å·**ï¼Œ å¯ç”¨æŸä¸ªæ–­ç‚¹

- 20ã€**breakpoint delete æ–­ç‚¹å·**ï¼Œåˆ é™¤æŸä¸ªæ–­ç‚¹

- 21ã€**breakpoint command add æ–­ç‚¹ç¼–å·**ï¼Œ ç»™æŸä¸ªæ–­ç‚¹æ·»åŠ ä¸€äº›æ‰§è¡Œå‘½ä»¤ï¼ˆæ‰§è¡Œè¯­å¥ã€æ–¹æ³•ï¼‰ç›¸å½“äºæ˜¯ï¼Œæ‰§è¡Œåˆ°è¿™ä¸ªæ–­ç”µåå¤šæ‰§è¡Œå‡ æ¡è¯­å¥
```
breakpoint set -n "-[ViewConreoller test]"  // ç»™æ§åˆ¶å™¨çš„test æ–¹æ³•å¢åŠ æ–­ç‚¹ï¼Œ åŠ å…¥è¿”å›çš„æ–­ç‚¹å·æ˜¯ 12

breakpoint command add 12 // ç»™ æ–­ç‚¹å·æ˜¯12 çš„æ–­ç‚¹å¢åŠ å‡ æ¡å‘½ä»¤ï¼ˆè¯­å¥ï¼‰,ä»¥ä¸‹ä¸‰å¥æ˜¯æ–°å¢çš„æ–­ç‚¹å‘½ä»¤ï¼ŒDONE æ˜¯ç»“æŸæŒ‡ä»¤
self.age = 32;
self.view.backgroundcolor = [UIColor redColor];
DONE  

```















































